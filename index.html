<!DOCTYPE html><html lang=en><head><title>Visit Red Bank</title><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=description content="An interactive map to help you enjoy your visit to Red Bank, New Jersey"><meta name=author content="Sarah Maris"><script src=js/lib-4dd0062713.min.js></script><script type=text/javascript src=http://oauth.googlecode.com/svn/code/javascript/oauth.js></script><script type=text/javascript src=http://oauth.googlecode.com/svn/code/javascript/sha1.js></script><script src=https://maps.googleapis.com/maps/api/js></script><script src=https://cdn.firebase.com/js/client/2.2.1/firebase.js></script><link href="https://fonts.googleapis.com/css?family=Architects+Daughter|Ubuntu:400,700" rel=stylesheet type=text/css><link rel=stylesheet href=css/style-abbb216e4e.min.css></head><body><header><h1>Red Bank</h1><h3>Trip Planner</h3></header><section id=place-list><span class=icon><i class=icon-search><input type=search placeholder="Name or Keyword" class=icon-search data-bind="value: searchFilter, css: 'icon-favorites', valueUpdate: 'afterkeydown', event: {keyup: filterLocations}"></i></span><div data-bind="foreach: filteredLocations().sort(function(left, right) { return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><div class=place data-bind="text: $data.name, click: viewModel.showDetails"></div></div><h2 id=favoritesTab class="favorites title icon-favorites icon-down">Favorites</h2><div id=favoritesList data-bind="foreach: favsSidebar().sort(function(left, right) { return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><div class="favorites location" data-bind="text: $data.name, click: viewModel.showDetails"></div></div><div><h4 class=instruction-title>Add a favorite location</h4><p class=instructions>Click on the map marker<br>Choose "Add to Favorites"</p></div><div data-bind="foreach: sidebarCats().sort(function(left, right) { return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><h2 data-bind="text: name, css: cat + ' title icon-up icon-' + cat, accordion: tabOpen, click: toggle"></h2><div data-bind="foreach: sidebarLocations"><div data-bind="text: $data.name, css: $parent.cat + ' location', click: viewModel.showDetails"></div></div></div></section><section id=map></section><footer></footer><script>function Model(){var e=this;e.locations=ko.observableArray(),e.categories=[{name:"Entertainment",yelpName:"movietheaters,musicvenues",cat:"entertainment"},{name:"Restaurants",yelpName:"restaurants",cat:"restaurant"},{name:"Hotels",yelpName:"hotels",cat:"hotel"},{name:"Shopping",yelpName:"shopping",cat:"shopping"}],e.getNewData=function(){e.counter=0,e.numCats=e.categories.length,e.getYelpData(e.categories[0])},e.getYelpData=function(t,o){var a={consumerKey:"fCSqFxVC56k7RxD-CXhtFg",consumerSecret:"_phQk4XXGzIsVRJ8ZfarixIURVw",accessToken:"Ar-g_-LjgtRcBcXgKbTZ9zahrH2kdNNH",accessTokenSecret:"NX2X5wtTxbjKn4Q04N0FWQoH-88",serviceProvider:{signatureMethod:"HMAC-SHA1"}},n="Red+Bank+NJ",s=3e3,i=1,r={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret};parameters=[],parameters.push(["location",n]),parameters.push(["category_filter",t.yelpName]),parameters.push(["radius_filter",s]),parameters.push(["sort",i]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",a.consumerKey]),parameters.push(["oauth_consumer_secret",a.consumerSecret]),parameters.push(["oauth_token",a.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var c={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(c),OAuth.SignatureMethod.sign(c,r);var l=OAuth.getParameterMap(c.parameters);l.oauth_signature=OAuth.percentEncode(l.oauth_signature),$.ajax({url:c.action,async:!0,data:l,cache:!0,dataType:"jsonp",jsonpCallback:"cb"}).done(function(o){model.getLocations(o.businesses,t),e.counter++,e.counter<e.numCats?e.getYelpData(e.categories[e.counter]):(storedLocations.set(e.locations()),viewModel.setMarkers(),viewModel.showCats(),e.getWundergroundData())}).fail(function(e){alert("fail"),console.log("Could not get data",e)})},e.getLocations=function(t,o){for(var a=0;a<t.length;a++)e.locations.push(new viewModel.bizInfo(t[a],o))},e.pwdByYelp="img/Powered_By_Yelp_Black.png",e.getWundergroundData=function(){$.ajax({url:"http://api.wunderground.com/api/4d00d2a5eb37d968/forecast/q/NJ/Red_Bank.json",dataType:"jsonp",async:!0}).done(function(e){console.log(e),viewModel.getWeather(e)}).fail(function(e){alert("fail"),console.log("Could not get data",e)})},e.wundergroundImg="img/wundergroundLogo_4c_horz.png"}function ViewModel(){var e=this;e.initializeLocations=function(){storedLocations.once("value",function(t){t.val()?(console.log("Receiving data from Firebase"),model.locations(t.val()),e.setMarkers(),e.showFavs(),e.showCats(),model.getWundergroundData()):(console.log("No stored data -- getting new data from Yelp"),model.getNewData())})},e.locations=ko.computed(function(){return model.locations()}),e.bizInfo=function(e,t){this.lat=e.location.coordinate.latitude,this.lng=e.location.coordinate.longitude,this.name=e.name,this.address=e.location.address[0],this.rating=e.rating,this.stars=e.rating_img_url,this.snippet=e.snippet_text,this.city=e.location.city,this.state=e.location.state_code,this.url=e.url,this.imgUrl=e.image_url?e.image_url:"img/no-image.png",this.phone=e.phone,this.dphone="("+e.phone.slice(0,3)+") "+e.phone.slice(3,6)+"-"+e.phone.slice(6);var o=[];e.categories.forEach(function(e){e.forEach(function(e){o.push(e)})}),o.push(this.name),this.keywords=o,this.cat=t.cat,this.icon="img/"+this.cat+".png",this.favIcon="img/fav-"+this.cat+".png",this.showIcon="img/"+this.cat+".png",this.fav=!1,this.windowHTML='<div class="place-name">'+this.name+"</div>",this.windowHTML+='<img class="place-image"src="'+this.imgUrl+'" alt="image of '+this.name+'">',this.windowHTML+='<div class="place-info">'+this.address+"<br>"+this.city+","+this.state+"<br>",this.windowHTML+='<a href="tel:'+this.phone+'">'+this.dphone+"</a><br>",this.windowHTML+='<img class="rating-image" src="'+this.stars+'" alt="Yelp star rating: '+this.rating+'">',this.windowHTML+='<img class="yelp" src="'+model.pwdByYelp+'" alt="Powered by Yelp"></div>',this.windowHTML+='<div class="review"><strong>Review Snippet</strong><br><span class="place-snippet">'+this.snippet+"</span></div>"},e.setInfoWindow=function(t,o){var a=document.createElement("div");a.innerHTML=t.windowHTML,a.setAttribute("class","info-window");var n=a.appendChild(document.createElement("div"));n.innerHTML='<a href="'+t.url+'" target="_blank">Read Full Review</a>',n.setAttribute("class","button"),t.favButton=a.appendChild(document.createElement("div")),t.favButton.innerHTML="Add to Favorites",t.favButton.setAttribute("class","button"),t.unFavButton=a.appendChild(document.createElement("div")),t.unFavButton.innerHTML="Remove from Favorites",t.unFavButton.setAttribute("class","button hide"),t.fav===!0?(t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button")):(t.favButton.setAttribute("class","button"),t.unFavButton.setAttribute("class","button hide")),google.maps.event.addDomListener(t.favButton,"click",function(){e.makeFav(t,o)}),google.maps.event.addDomListener(t.unFavButton,"click",function(){e.removeFav(t,o)}),t.infoWindowContent=a},e.setMarkers=function(){for(var t=this.locations(),o=0;o<t.length;o++){var a=t[o];a.marker=new google.maps.Marker({position:{lat:a.lat,lng:a.lng},map:view.map,title:a.title,icon:a.showIcon,animation:google.maps.Animation.DROP}),e.setInfoWindow(a,o),a.infoWindow=new google.maps.InfoWindow;var n=a.marker,s=a.infoWindowContent,i=a.infoWindow;google.maps.event.addListener(n,"click",function(t,o,a){return function(){a.setContent(o),a.open(view.map,t),e.bounceMarker(t)}}(n,s,i))}},e.bounceMarker=function(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},750)},e.sidebarCats=ko.observableArray(),e.showCats=function(t){for(var o=model.categories,a=0;a<o.length;a++){var n={};n.cat=o[a].cat,n.name=o[a].name;for(var s=[],i=e.locations(),r=0;r<i.length;r++)i[r].cat==n.cat&&s.push(i[r]);n.sidebarLocations=ko.observableArray(s),n.tabOpen=ko.observable(!0),n.toggle=function(e,t){var o=e.tabOpen();e.tabOpen(!o)},e.sidebarCats.push(n)}},e.visibleCategories=ko.observableArray(),e.showMarkers=function(){var t=e.visibleCategories(),o=e.locations();o.forEach(function(o){var a=!1;t.indexOf("favs")>=0&&o.fav&&(a=!0),t.indexOf(o.cat)>=0&&(a=!0),a?(o.marker.setVisible(!0),e.bounceMarker(o.marker)):(o.infoWindow.close(),o.marker.setVisible(!1))})},e.toggleTabs=function(t,o,a){o?(e.searchFilter(""),e.filteredLocations.removeAll(),e.visibleCategories.push(a.cat),$(t).next().slideDown("400"),$(t).removeClass("icon-down").addClass("icon-up")):e.closeTab(a,t),e.showMarkers()},e.closeTab=function(t,o){e.visibleCategories.remove(t.cat),$(o).next().slideUp("400"),$(o).removeClass("icon-up").addClass("icon-down"),t.tabOpen(!1)},e.searchFilter=ko.observable(""),e.filteredLocations=ko.observableArray(),e.filterLocations=function(){var t=e.sidebarCats();t.forEach(function(t){var o=".title."+t.cat;console.log(t.cat,t.tabOpen(),o),e.closeTab(t,o)}),favsClosed=e.favsClosed(),favsClosed||(e.visibleCategories.remove("favs"),e.favsClosed(!0),$("#favoritesTab").toggleClass("icon-down icon-up"),$("#favoritesTab").next().slideToggle("400"));var o=e.searchFilter().toLowerCase();e.filteredLocations.removeAll(),e.locations().forEach(function(t){t.infoWindow.close(),t.marker.setVisible(!1);var a=!1;t.keywords.forEach(function(n){n.toLowerCase().indexOf(o)>=0&&(a=!0,t.marker.setVisible(!0),e.bounceMarker(t.marker))}),a&&e.filteredLocations.push(t)})},e.showDetails=function(t){t.infoWindow.close();var o=t.marker,a=t.infoWindow;e.bounceMarker(t.marker),a.setContent(t.infoWindowContent),a.open(view.map,o)},e.favsSidebar=ko.observableArray(),e.showFavs=function(){e.favsSidebar.removeAll(),e.locations().forEach(function(t){t.fav===!0&&e.favsSidebar.push(t)})},e.makeFav=function(t,o){t.fav=!0,t.infoWindow.close(),t.showIcon=t.favIcon,t.marker.icon=t.showIcon,t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button"),storedLocations.child(o).update({fav:!0,showIcon:t.favIcon}),e.bounceMarker(t.marker),e.showFavs()},e.removeFav=function(t,o){t.fav=!1,t.infoWindow.close(),t.showIcon=t.icon,t.marker.icon=t.showIcon,t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button"),storedLocations.child(o).update({fav:!1,showIcon:t.icon}),e.bounceMarker(t.marker),e.showFavs()},e.favsClosed=ko.observable(!0),e.getWeather=function(t){var o=t.forecast.simpleforecast.forecastday,a=t.forecast.txt_forecast.forecastday[0];console.log(o,a),e.forecast=ko.observableArray();for(var n=0;n<o.length;n++){var s={};s.shortday=o[n].date.weekday_short,s.fullday=o[n].date.weekday,s.month=o[n].date.monthname,s.date=o[n].date.day,s.highTemp=o[n].high.fahrenheit,s.lowTemp=o[n].low.fahrenheit,s.icon=o[n].icon,s.iconURL=o[n].icon_url,s.precip=o[n].pop,e.forecast.push(s)}console.log(e.forecast())},e.initializeLocations()}function View(){var e=this;e.initializeMap=function(){var t=document.getElementById("map"),o={center:new google.maps.LatLng(40.351724,-74.067342),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP};e.map=new google.maps.Map(t,o)},google.maps.event.addDomListener(window,"load",this.initializeMap),$(document).ready(function(e){e("#favoritesTab").click(function(){favsClosed=viewModel.favsClosed(),e("#favoritesTab").toggleClass("icon-down icon-up"),e("#favoritesTab").next().slideToggle("400"),favsClosed?(viewModel.searchFilter(""),viewModel.filteredLocations.removeAll(),viewModel.visibleCategories.push("favs"),viewModel.favsClosed(!1)):(viewModel.visibleCategories.remove("favs"),viewModel.favsClosed(!0))})})}ko.bindingHandlers.accordion={update:function(e,t,o,a,n){var s=ko.unwrap(t());viewModel.toggleTabs(e,s,a)}};var storedLocations=new Firebase("https://blistering-heat-6713.firebaseio.com/"),model=new Model,viewModel=new ViewModel,view=new View;ko.applyBindings(viewModel);</script></body></html>