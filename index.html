<!DOCTYPE html><html lang=en><head><title>Visit Red Bank</title><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=description content="An interactive map to help you enjoy your visit to Red Bank, New Jersey"><meta name=author content="Sarah Maris"><script src=js/lib-4dd0062713.min.js></script><script type=text/javascript src=http://oauth.googlecode.com/svn/code/javascript/oauth.js></script><script type=text/javascript src=http://oauth.googlecode.com/svn/code/javascript/sha1.js></script><script src=https://cdn.firebase.com/js/client/2.2.1/firebase.js></script><link href="https://fonts.googleapis.com/css?family=Architects+Daughter|Ubuntu:400,700" rel=stylesheet type=text/css><link rel=stylesheet href=css/style-44927b53e7.min.css></head><body><div class=flexcontainer><section id=title-box><h1 id=site-title>Red Bank</h1><h3 id=subtitle>Trip Planner</h3></section><section id=weather-box><div id=forecast><div id=forecast-box data-bind="foreach: forecast"><div class=weather-info><div class=day data-bind="text: $data.shortday"></div><div class=temp data-bind="text: $data.highTemp"></div><div class=temp data-bind="text: $data.lowTemp"></div><img class=weather-icon data-bind="attr: { src: $data.iconURL, alt: $data.icon }"></div></div></div><div id=current><h3 id=current-title>Current Weather Conditions</h3><p id=current-conditions data-bind="text: currentConditions"></p><p id=attribution>Weather data from</p><img id=wunderground-logo src=img/wundergroundLogo_4c_rev_horz.png alt="weather data from Wunderground"></div></section><section id=sidebar><div id=search-box><span class=icon><i class=icon-search><input placeholder="Name or Keyword" class=icon-search data-bind="value: searchText, css: 'icon-favorites', valueUpdate: 'afterkeydown', event: {keyup: filterLocations}"></i></span><div data-bind="foreach: filteredLocations().sort(function(left, right) {return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1)})"><div class="search location" data-bind="text: $data.name, click: viewModel.showDetails"></div></div></div><h2 id=favoritesTab class="favorites title icon-favorites icon-down">Favorites</h2><div id=favoritesList data-bind="foreach: favsSidebar().sort(function(left, right) {return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><div class="favorites location" data-bind="text: $data.name, click: viewModel.showDetails"></div></div><div id=favorites-instructions><h4 class=instruction-title>Add a favorite location</h4><p class=instructions>Click on the map marker<br>Choose "Add to Favorites"</p></div><div data-bind="foreach: sidebarCats().sort(function(left, right) {return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><h2 data-bind="text: name, css: cat + ' title icon-up icon-' + cat, accordion: tabOpen, click: toggle"></h2><div data-bind="foreach: sidebarLocations().sort(function(left, right) {return left.name == right.name ? 0 : (left.name < right.name ? -1 : 1) })"><div data-bind="text: $data.name, css: $parent.cat + ' location', click: viewModel.showDetails"></div></div></div></section><section id=map></section></div><script>function Model(){var e=this;e.locations=ko.observableArray(),e.categories=[{name:"Entertainment",yelpName:"movietheaters,musicvenues",cat:"entertainment"},{name:"Restaurants",yelpName:"restaurants",cat:"restaurant"},{name:"Hotels",yelpName:"hotels",cat:"hotel"},{name:"Shopping",yelpName:"shopping",cat:"shopping"}],e.getNewData=function(){e.counter=0,e.numCats=e.categories.length,e.getYelpData(e.categories[0])},e.getYelpData=function(t,a){var o={consumerKey:"fCSqFxVC56k7RxD-CXhtFg",consumerSecret:"_phQk4XXGzIsVRJ8ZfarixIURVw",accessToken:"Ar-g_-LjgtRcBcXgKbTZ9zahrH2kdNNH",accessTokenSecret:"NX2X5wtTxbjKn4Q04N0FWQoH-88",serviceProvider:{signatureMethod:"HMAC-SHA1"}},n="Red+Bank+NJ",i=3e3,s=1,r={consumerSecret:o.consumerSecret,tokenSecret:o.accessTokenSecret};parameters=[],parameters.push(["location",n]),parameters.push(["category_filter",t.yelpName]),parameters.push(["radius_filter",i]),parameters.push(["sort",s]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",o.consumerKey]),parameters.push(["oauth_consumer_secret",o.consumerSecret]),parameters.push(["oauth_token",o.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var l={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(l),OAuth.SignatureMethod.sign(l,r);var c=OAuth.getParameterMap(l.parameters);c.oauth_signature=OAuth.percentEncode(c.oauth_signature),$.ajax({url:l.action,async:!0,data:c,cache:!0,dataType:"jsonp",jsonpCallback:"cb"}).done(function(a){model.getLocations(a.businesses,t),e.counter++,e.counter<e.numCats?e.getYelpData(e.categories[e.counter]):(storedLocations.set(e.locations()),viewModel.setMarkers(),viewModel.showCats(),e.getWundergroundData())}).fail(function(t){$("#favorites-instructions").replaceWith('<p id="locations-error">No location data available. <br> Try again later</p>'),console.log("Unable to load Yelp Data",t),e.getWundergroundData()})},e.getLocations=function(t,a){for(var o=0;o<t.length;o++)e.locations.push(new viewModel.bizInfo(t[o],a))},e.getWundergroundData=function(){$.ajax({url:"http://api.wunderground.com/api/4d00d2a5eb37d968/forecast/q/NJ/Red_Bank.json",dataType:"jsonp",async:!0}).done(function(e){if(e.response.error){var t=e.response.error.description;$("#forecast-box").append('<p id="weather-error">No weather data available. <br> Try again later</p>'),$("#current-conditions").append('<p id="current-error">N/A</p>'),console.log('Unable to load Wunderground data. Error code:"',t,'"')}else console.log("Receiving weather data from Wunderground"),viewModel.getWeather(e)}).fail(function(e){alert("fail"),console.log("Could not get Wunderground data: ",e)})}}function ViewModel(){var e=this;e.initializeLocations=function(){storedLocations.once("value",function(t){t.val()?(console.log("Receiving location and favorites data from Firebase"),model.locations(t.val()),e.setMarkers(),e.showFavs(),e.showCats(),model.getWundergroundData()):(console.log("No stored data -- getting new location data from Yelp"),model.getNewData())})},e.locations=ko.computed(function(){return model.locations()}),e.bizInfo=function(e,t){this.lat=e.location.coordinate.latitude,this.lng=e.location.coordinate.longitude,this.name=e.name,this.address=e.location.address[0],this.rating=e.rating,this.stars=e.rating_img_url,this.snippet=e.snippet_text,this.city=e.location.city,this.state=e.location.state_code,this.url=e.url,this.imgUrl=e.image_url?e.image_url:"img/no-image.png",this.phone=e.phone,this.dphone="("+e.phone.slice(0,3)+") "+e.phone.slice(3,6)+"-"+e.phone.slice(6);var a=[];e.categories.forEach(function(e){e.forEach(function(e){a.push(e)})}),a.push(this.name),this.keywords=a,this.cat=t.cat,this.icon="img/"+this.cat+".png",this.favIcon="img/fav-"+this.cat+".png",this.showIcon="img/"+this.cat+".png",this.fav=!1,this.windowHTML='<div class="place-name">'+this.name+"</div>",this.windowHTML+='<img class="place-image"src="'+this.imgUrl+'" alt="image of '+this.name+'">',this.windowHTML+='<div class="place-info">'+this.address+"<br>"+this.city+","+this.state+"<br>",this.windowHTML+='<a href="tel:'+this.phone+'">'+this.dphone+"</a><br>",this.windowHTML+='<img class="rating-image" src="'+this.stars+'" alt="Yelp star rating: '+this.rating+'">',this.windowHTML+='<img class="yelp" src="img/Powered_By_Yelp_Black.png" alt="Powered by Yelp"></div>',this.windowHTML+='<div class="review"><strong>Review Snippet</strong><br><span class="place-snippet">'+this.snippet+"</span></div>"},e.setInfoWindow=function(t,a){var o=document.createElement("div");o.innerHTML=t.windowHTML,o.setAttribute("class","info-window");var n=o.appendChild(document.createElement("div"));n.innerHTML='<a href="'+t.url+'" target="_blank">Read Full Review</a>',n.setAttribute("class","button"),t.favButton=o.appendChild(document.createElement("div")),t.favButton.innerHTML="Add to Favorites",t.favButton.setAttribute("class","button"),t.unFavButton=o.appendChild(document.createElement("div")),t.unFavButton.innerHTML="Remove from Favorites",t.unFavButton.setAttribute("class","button hide"),t.fav===!0?(t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button")):(t.favButton.setAttribute("class","button"),t.unFavButton.setAttribute("class","button hide")),google.maps.event.addDomListener(t.favButton,"click",function(){e.makeFav(t,a)}),google.maps.event.addDomListener(t.unFavButton,"click",function(){e.removeFav(t,a)}),t.infoWindowContent=o},e.setMarkers=function(){for(var t=this.locations(),a=0;a<t.length;a++){var o=t[a];o.marker=new google.maps.Marker({position:{lat:o.lat,lng:o.lng},map:view.map,title:o.title,icon:o.showIcon,animation:google.maps.Animation.DROP}),e.setInfoWindow(o,a),o.infoWindow=new google.maps.InfoWindow;var n=o.marker,i=o.infoWindowContent,s=o.infoWindow;google.maps.event.addListener(n,"click",function(t,a,o){return function(){o.setContent(a),o.open(view.map,t),e.bounceMarker(t)}}(n,i,s))}},e.bounceMarker=function(e){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},750)},e.sidebarCats=ko.observableArray(),e.showCats=function(t){for(var a=model.categories,o=0;o<a.length;o++){var n={};n.cat=a[o].cat,n.name=a[o].name;for(var i=[],s=e.locations(),r=0;r<s.length;r++)s[r].cat==n.cat&&i.push(s[r]);n.sidebarLocations=ko.observableArray(i),n.tabOpen=ko.observable(!1),n.toggle=function(e,t){var a=e.tabOpen();e.tabOpen(!a)},e.sidebarCats.push(n)}},e.visibleCategories=ko.observableArray(),e.showMarkers=function(){var t=e.visibleCategories(),a=e.locations();a.forEach(function(a){var o=!1;t.indexOf("favs")>=0&&a.fav&&(o=!0),t.indexOf(a.cat)>=0&&(o=!0),o?(a.marker.setVisible(!0),e.bounceMarker(a.marker)):(a.infoWindow.close(),a.marker.setVisible(!1))})},e.toggleTabs=function(t,a,o){a?(e.searchText(""),e.filteredLocations.removeAll(),e.visibleCategories.push(o.cat),$(t).next().slideDown("400"),$(t).removeClass("icon-down").addClass("icon-up")):e.closeTab(o,t),e.showMarkers()},e.closeTab=function(t,a){e.visibleCategories.remove(t.cat),$(a).next().slideUp("400"),$(a).removeClass("icon-up").addClass("icon-down"),t.tabOpen(!1)},e.searchText=ko.observable(""),e.filteredLocations=ko.observableArray(),e.filterLocations=function(){var t=e.searchText(),a=e.sidebarCats();a.forEach(function(t){var a=".title."+t.cat;e.closeTab(t,a)}),favsClosed=e.favsClosed(),favsClosed||(e.visibleCategories.remove("favs"),e.favsClosed(!0),$("#favoritesTab").toggleClass("icon-down icon-up"),$("#favoritesTab").next().slideToggle("400")),e.filteredLocations.removeAll(),e.locations().forEach(function(a){a.infoWindow.close(),a.marker.setVisible(!1);var o=!1;a.keywords.forEach(function(n){n.toLowerCase().indexOf(t)>=0&&(o=!0,a.marker.setVisible(!0),e.bounceMarker(a.marker))}),o&&e.filteredLocations.push(a)}),e.searchText(t)},e.showDetails=function(t){t.infoWindow.close();var a=t.marker,o=t.infoWindow;e.bounceMarker(t.marker),o.setContent(t.infoWindowContent),o.open(view.map,a)},e.favsSidebar=ko.observableArray(),e.showFavs=function(){e.favsSidebar.removeAll(),e.locations().forEach(function(t){t.fav===!0&&e.favsSidebar.push(t)})},e.makeFav=function(t,a){t.fav=!0,t.infoWindow.close(),t.showIcon=t.favIcon,t.marker.icon=t.showIcon,t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button"),storedLocations.child(a).update({fav:!0,showIcon:t.favIcon}),e.bounceMarker(t.marker),e.showFavs()},e.removeFav=function(t,a){t.fav=!1,t.infoWindow.close(),t.showIcon=t.icon,t.marker.icon=t.showIcon,t.favButton.setAttribute("class","button hide"),t.unFavButton.setAttribute("class","button"),storedLocations.child(a).update({fav:!1,showIcon:t.icon}),e.bounceMarker(t.marker),e.showFavs()},e.favsClosed=ko.observable(!0),e.allMarkers=ko.observableArray(),e.showAll=function(){var t=e.locations(),a=""!==e.searchText(),o=e.visibleCategories().length>=1,n=[];if(!a&&!o)for(var i=0;i<t.length;i++)t[i].marker.setVisible(!0),e.bounceMarker(t[i].marker),n.push(t[i]);e.allMarkers(n)},e.currentConditions=ko.observable(),e.forecast=ko.observableArray(),e.getWeather=function(t){for(var a=t.forecast.simpleforecast.forecastday,o=t.forecast.txt_forecast.forecastday[0].fcttext,n=0;n<a.length;n++){var i={};i.shortday=a[n].date.weekday_short,i.highTemp=a[n].high.fahrenheit+"°",i.lowTemp=a[n].low.fahrenheit+"°",i.iconURL=a[n].icon_url.replace("k","i"),i.iconAlt=a[n].icon,e.forecast.push(i)}e.currentConditions(o)},e.initializeLocations()}function View(){var e=this;e.initializeMap=function(){var t=[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:55},{gamma:.47}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{hue:"#ff0033"},{gamma:.58},{saturation:26},{visibility:"on"}]},{featureType:"water",elementType:"all",stylers:[{color:"#1b317d"},{lightness:60},{gamma:1.87}]}],a=document.getElementById("map"),o={center:new google.maps.LatLng(40.351724,-74.067342),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:t};e.map=new google.maps.Map(a,o)},google.maps.event.addDomListener(window,"load",this.initializeMap),$(document).ready(function(e){e("#favoritesTab").click(function(){favsClosed=viewModel.favsClosed(),e("#favoritesTab").toggleClass("icon-down icon-up"),e("#favoritesTab").next().slideToggle("400"),favsClosed?(viewModel.searchText(""),viewModel.filteredLocations.removeAll(),viewModel.visibleCategories.push("favs"),viewModel.favsClosed(!1)):(viewModel.visibleCategories.remove("favs"),viewModel.favsClosed(!0))})})}ko.bindingHandlers.accordion={update:function(e,t,a,o,n){var i=ko.unwrap(t());viewModel.toggleTabs(e,i,o),viewModel.showAll()}};var storeLocations,model,viewModel,view,initializeApp=function(){storedLocations=new Firebase("https://blistering-heat-6713.firebaseio.com/"),model=new Model,viewModel=new ViewModel,view=new View,ko.applyBindings(viewModel)};$.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyD4Hf4D47wT3dI_iA6kyul2YFsvzjDMHFE").done(function(){initializeApp(),console.log("Receiving data from Google Maps")}).fail(function(e,t,a){$("#map").append('<p id="locations-error">Google Map not available. <br> Try again later</p>'),console.log("Unable to load Google Maps",a)});</script></body></html>